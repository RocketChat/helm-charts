{{ if and .Values.ingress.enabled (or .Values.ingress.prometheus.enabled .Values.ingress.grafana.enabled) }}
{{- if not .Values.ingress.ingressClassName }}
  {{- fail "ingress.ingressClassName is required when ingress.enabled is true, and it must be one of: nginx, traefik" }}
{{- end }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ .Release.Name }}-ingress
  namespace: {{ .Release.Namespace }}
spec:
  ingressClassName: "{{ .Values.ingress.ingressClassName }}"
  rules:
    {{- if .Values.ingress.prometheus.enabled }}
      {{- if not .Values.ingress.prometheus.host }}
        {{- fail "ingress.prometheus.host is required when ingress.enabled is true" }}
      {{- end }}
    - host: {{ .Values.ingress.prometheus.host }}
      http:
        paths:
          - path: {{ .Values.ingress.prometheus.path }}
            pathType: Prefix
            backend:
              service:
                name: prometheus-operated
                port:
                  name: http-web
    {{- end }}
    {{- if .Values.ingress.grafana.enabled }}
      {{- if not .Values.ingress.grafana.host }}
        {{- fail "ingress.grafana.host is required when ingress.enabled is true" }}
      {{- end }}
    - host: {{ .Values.ingress.grafana.host }}
      http:
        paths:
          - path: {{ .Values.ingress.grafana.path }}
            pathType: Prefix
            backend:
              service:
                name: grafana-service
                port:
                  name: grafana
    {{- end }}
  {{ if or .Values.ingress.prometheus.tls .Values.ingress.grafana.tls }}
    tls:
      - hosts:
          {{- if .Values.ingress.prometheus.tls }}
            - {{ .Values.ingress.prometheus.host }}
          {{- end }}
          {{- if .Values.ingress.grafana.tls }}
            - {{ .Values.ingress.grafana.host }}
          {{- end }}
      secretName: prometheus-prometheus-tls
  {{ end }}
{{ end }} # if ingress.enabled